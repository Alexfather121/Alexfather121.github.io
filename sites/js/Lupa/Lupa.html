<!DOCTYPE HTML>
<html>
<head>
	<meta charset = "utf-8">
	<title>Листинг 9.5</title>
<!--Начало сценария-->
<script type="text/javascript">
//Количество строк и количество столбцов, на которые
//разбивается исходное изображение:
let rows = 3, cols = 6
//полная ссылка на файл с изображением:
let file = "./pets.jpg"
//Коэффициент масштабирования для отображения
//отдельного фрагмента изображения:
let R = 2
//Переменные для записи ссылок на массив графических
//областей и на объект графической области, в которой
//отображается увеличенный фрагмент изображения:
let Cnv, outCnv
//Переменные для записи ссылок на массив объектов
//графических контекстов и на объект графического
//контекста области, в которой отображается фрагмент
//исходного изображения:
let Ctx, outCtx
//Переменная для записи ссылки на таблицу, содержащую
//ячейки с графическими областями:
let mytab
//Переменная для записи ссылки на объект исходного
//изображения:
let myimg
//Обработчик события, связанного с загрузкой документа:
window.onload = function(){
    //Создание объекта изображения:
    myimg = new Image()
    //Ссылка на файл с изображением:
    myimg.src = file
    //Получение ссылки на таблицу для размещения
    //ячеек с графическими областями:
    mytab = document.getElementById("mytable")
    //Получение ссылки на графиескую область,
    //предназначенную для отображения фрагмента
    //исходного изображения:
    outCnv = document.getElementById("output")
    //Получение ссылки на объект графического контекста
    //области, предназначенной для отображения фрагмента
    //исходного изображения:
    outCtx = outCnv.getContext("2d")
    //Создание массива для объектов
    //графических областей:
    Cnv = new Array(rows)
    //Создание массива для объектов графических
    //контекстов графических областей:
    Ctx = new Array(rows)
    //Перебор строк в массивах:
    for(let i = 0; i < rows; i++){
        //Добавление в таблицу строки:
        mytab.insertRow(i)
        //Создание строки для массива объектов
        //графических областей:
        Cnv[i] = new Array(cols)
        //Создание строки для массива объектов
        //графических контекстов:
        Ctx[i] = new Array(cols)
        //Перебор элементов в строке:
        for(let j = 0; j < cols; j++){
            //Добавление в строку таблицы новой ячейки:
            mytab.rows[i].insertCell(j)
            //Создание элемента массива-объекта
            //графической облатси:
            Cnv[i][j] = document.createElement("canvas")
            //Создание элемента массива-объекта
            //графического контекста:
            Ctx[i][j] = Cnv[i][j].getContext("2d")
            //Добавление графической области
            //в ячейку таблицы:
            mytab.rows[i].cells[j].appendChild(Cnv[i][j])
            //Обработчик события, связанного с наведением
            //курсора мыши на области ячейки таблицы:
            mytab.rows[i].cells[j].onmouseover = function(){
                //Локальные индексные переменные:
                let m, n
                //Вычисление индекса строки, в которой
                //находится ячейка
                m = this.parentElement.rowIndex
                //вычисление индекса столбца, в котором
                //находится ячейка:
                n = this.cellIndex
                //Цвет рамки вокруг графической области,
                //связанной с ячейкой:
                Cnv[m][n].style.borderColor="#505050"
                //цвет рамки вокруг графической области,
                //предназначенной для отображения фрагмента
                //исходного изображения:
                outCnv.style.borderColor="#505050"
                //Отображение фрагмента исходного
                //изображения:
                outCtx.drawImage(Cnv[m][n],0,0,Cnv[m][n].width,Cnv[m][n].height,0,0,outCnv.width,outCnv.height)
            }
            //Обработчик события, связанного
            //с перемещением курсора мыши за пределы
            //области ячейки:
            mytab.rows[i].cells[j].onmouseout = function(){
                //Локальная переменная для записи ссылки
                //на графическую область, размещенную
                //внутри ячейки таблицы:
                let cnv
                //Получение ссылки на графическую область
                //внутри ячейки таблицы:
                cnv = this.getElementsByTagName("canvas")[0]
                //Цвет рамки вокруг графической области
                //внутри ячейки таблицы:
                cnv.style.borderColor = "silver"
                //Цвет рамки вокруг графической области, в
                //которой отображается фрагмент
                //исходного изображения:
                outCnv.style.borderColor = "silver"
                //Очистка графической облатси,
                //предназначенной для отображения фрагмента
                //исходного изображения:
                outCtx.clearRect(0,0,outCnv.width, outCnv.height)
                }
        }
        
    }
    //Обработчик события, связанного с загрузкой
    //исходного изображения:
    myimg.onload = function(){
        //Локальные переменные для записи значений ширины
        //и высоты изображений, отображаемых внутри
        //ячеек таблицы:
        let width, height
        //Вычисление ширины изображения в ячейке:
        width = Math.floor(this.width/cols)
        //Вычисление высоты изображения в ячейке:
        height = Math.floor(this.height/rows)
        //Высота графической области, предназначенной
        //для отображения отдельного фрагмента
        //исходного изображения:
        outCnv.height = Math.round(R*height)
        //Ширина графической области, предназначенной
        //для отображения отдельного фрагмента
        //исходного изображения:
        outCnv.width = Math.round(R*width)
        //Перебор строк в массиве графических областей:
        for(let i = 0; i < Cnv.length; i++){
            //Перебор элементов в строке массива:
            for(let j = 0; j < Cnv[i].length; j++){
                //Ширина графической области в ячейке:
                Cnv[i][j].width = width
                //Высота графической области в ячейке:
                Cnv[i][j].height = height
                //Сплошная рамка вокруг области:
                Cnv[i][j].style.border = "solid"
                //Толщина рамки для области:
                Cnv[i][j].style.borderWidth = "3px"
                //Цвет рамки для области:
                Cnv[i][j].style.borderColor = "silver"
                //Отображение фрагмента исходного
                //изображения внутри ячейки таблицы:
                Ctx[i][j].drawImage(this,j*width,i*height,width,height,0,0,width,height)
            }
        }
    }
}
</script>
<!--Завершение сценария-->
<!--Описание стилей-->
<style type="text/css">
/*Стиль таблицы mytable*/
#mytable{
    padding: 2px;
    border-style: solid;
    border-width: 3px;
    border-color: silver;
    border-spacing: 0px;
}
/*Стиль ячейки таблицы mytable*/
#mytable td{
    padding: 0px 2px;
}
/*Стиль графической области для вывода отдельного
фрагмента изображения*/
#output{
    border-style: solid;
    border-color: silver;
    border-width: 3px;
    padding: 2px;
}
</style>
<!--Завершение описания стилей-->
</head>
<body>
<h3>Листинг 9.5</h3><hr/>
<!--Внешняя таблица-->
<table>
<!--Строка внешней таблицы-->
<tr>
<!--Первая ячейка в строке внешней таблицы-->
<td style="vertical-align: top;">
<!--Внутренняя таблица mytable-->
<table id="mytable"></table>
</td>
<!--Вторая ячейка в строке внешней таблицы-->
<td style="vertical-align: top;">
<!--Графическая область для отображения фрагмента
исходного изображения-->
<canvas id="output"></canvas>
</td>
</tr>
</table>
</body>
</html>
